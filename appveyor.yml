version: 1.0.{build}

environment:
  COVERALLS_REPO_TOKEN:
    secure: h3STBSYmb0eJYYQmEuI2XBWo5VkvRBGv8u6POp/fIN7ROz5R0762/kj/eXz6mM8k

build:
  parallel: true

build_script:
 - cmd: >-
    mkdir build
    
    cd build
    
    mkdir ringmesh
    
    cd ringmesh
    
    cmake -DRINGMESH_WITH_GRAPHICS:BOOL=ON -DRINGMESH_WITH_UTILITIES:BOOL=ON -DRINGMESH_WITH_TESTS:BOOL=ON ../..
    
    cmake --build . --config Release
    
#test_script:
# - cmd: cmake --build . --target RUN_TESTS --config Release

after_test:
 - cmd: >-
    nuget install OpenCover -Version 4.6.519 -OutputDirectory tools
    
    nuget install coveralls.net -Version 0.412.0 -OutputDirectory tools
    
    .\tools\OpenCover.4.6.519\tools\OpenCover.Console.exe -target:cmake -targetargs:"--build . --target RUN_TESTS --config Release"
        
    .\tools\coveralls.net.0.412\tools\csmacnz.Coveralls.exe --opencover -i .\results.xml 
    